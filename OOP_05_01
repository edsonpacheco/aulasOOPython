"""
MÃ¡quina de Estados - Torniquete (Catraca)
=========================================
Exemplo clÃ¡ssico e didÃ¡tico com apenas 2 estados e 2 eventos.
Estados: Travado, Destravado
Eventos: moeda, empurrar
"""

from abc import ABC, abstractmethod
# =============================================================================
# INTERFACE DE ESTADO
# =============================================================================
class Estado(ABC):
    """Interface para os estados do torniquete."""
    
    @abstractmethod
    def moeda(self, torniquete: 'Torniquete') -> None:
        """Evento: usuÃ¡rio insere moeda."""
        pass
    
    @abstractmethod
    def empurrar(self, torniquete: 'Torniquete') -> None:
        """Evento: usuÃ¡rio empurra a catraca."""
        pass
    
    def __str__(self) -> str:
        return self.__class__.__name__


# =============================================================================
# ESTADOS CONCRETOS
# =============================================================================

class Travado(Estado):
    """Estado: torniquete bloqueado."""
    
    def moeda(self, torniquete: 'Torniquete') -> None:
        print("ğŸª™ Moeda aceita!")
        print("ğŸ”“ Destravando...")
        torniquete._estado = Destravado()
    
    def empurrar(self, torniquete: 'Torniquete') -> None:
        print("ğŸš« Bloqueado! Insira uma moeda.")
        print("ğŸ”” ALARME!")


class Destravado(Estado):
    """Estado: torniquete liberado para passagem."""
    
    def moeda(self, torniquete: 'Torniquete') -> None:
        print("ğŸª™ Moeda extra ignorada (jÃ¡ destravado).")
    
    def empurrar(self, torniquete: 'Torniquete') -> None:
        print("ğŸš¶ Passagem liberada!")
        print("ğŸ”’ Travando...")
        torniquete._estado = Travado()


# =============================================================================
# CONTEXTO
# =============================================================================
class Torniquete:
    """Contexto: representa o torniquete fÃ­sico."""
    
    def __init__(self):
        self._estado: Estado = Travado()
        print("â•" * 40)
        print("  TORNIQUETE INICIADO")
        print("â•" * 40)
    
    @property
    def estado(self) -> str:
        return str(self._estado)
    
    def moeda(self) -> None:
        print(f"\n[Estado: {self._estado}] â†’ Evento: MOEDA")
        self._estado.moeda(self)
        print(f"[Novo estado: {self._estado}]")
    
    def empurrar(self) -> None:
        print(f"\n[Estado: {self._estado}] â†’ Evento: EMPURRAR")
        self._estado.empurrar(self)
        print(f"[Novo estado: {self._estado}]")

# =============================================================================
# DEMONSTRAÃ‡ÃƒO
# =============================================================================
def demo():
    t = Torniquete()
    
    print("\n--- CenÃ¡rio 1: Fluxo normal ---")
    t.moeda()      # Travado â†’ Destravado
    t.empurrar()   # Destravado â†’ Travado
    
    print("\n--- CenÃ¡rio 2: Empurrar sem pagar ---")
    t.empurrar()   # Travado â†’ Travado (alarme!)
    
    print("\n--- CenÃ¡rio 3: Moeda extra ---")
    t.moeda()      # Travado â†’ Destravado
    t.moeda()      # Destravado â†’ Destravado (ignora)
    t.empurrar()   # Destravado â†’ Travado
    
    print("\n" + "â•" * 40)
    print("  FIM DA DEMONSTRAÃ‡ÃƒO")
    print("â•" * 40)


if __name__ == "__main__":
    demo()
